<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hawthorn.login.repository.SysMenuMapper">
  <!-- 通用查询映射结果到DTO(不带公共字段) -->
  <resultMap id="BaseResultMap" type="com.hawthorn.login.model.dto.sysmenu.SysMenuDTO">
    <id column="id" jdbcType="BIGINT" property="id"/>
    <result column="name" jdbcType="VARCHAR" property="name"/>
    <result column="parent_id" jdbcType="BIGINT" property="parentId"/>
    <result column="url" jdbcType="VARCHAR" property="url"/>
    <result column="perms" jdbcType="VARCHAR" property="perms"/>
    <result column="type" jdbcType="INTEGER" property="type"/>
    <result column="icon" jdbcType="VARCHAR" property="icon"/>
    <result column="order_num" jdbcType="INTEGER" property="orderNum"/>
  </resultMap>

  <!-- 通用查询映射结果到PO(带公共字段) -->
  <resultMap id="BaseResultMapAll" type="com.hawthorn.login.model.po.SysMenuPO">
    <!-- 主键 -->
    <id column="id" property="id"/>
    <!-- 公共字段 -->
    <result column="create_by" property="createBy"/>
    <result column="create_time" property="createTime"/>
    <result column="last_update_by" property="lastUpdateBy"/>
    <result column="last_update_time" property="lastUpdateTime"/>
    <result column="del_flag" property="delFlag"/>
    <!-- 业务字段 -->
    <result column="name" property="name"/>
    <result column="parent_id" property="parentId"/>
    <result column="url" property="url"/>
    <result column="perms" property="perms"/>
    <result column="type" property="type"/>
    <result column="icon" property="icon"/>
    <result column="order_num" property="orderNum"/>
  </resultMap>

  <!-- 通用查询结果列(不带公共字段) -->
  <sql id="Base_Column_List">
    id, name, parent_id, url, perms, type, icon, order_num
  </sql>
  <!--  -->
  <sql id="FindByUserName_Column_List">
    m.id, m.name, m.parent_id, m.url, m.perms, m.type, m.icon, m.order_num
  </sql>
  <!-- 通用查询结果列(带公共字段) -->
  <sql id="Base_Column_ListAll">
    id, name, parent_id, url, perms, type, icon, order_num
    <!-- 公共字段 -->
    ,create_by
    ,create_time
    ,last_update_by
    ,last_update_time
    ,del_flag
  </sql>
  <!-- 表名 -->
  <sql id="Base_Table_List">
    sys_menu
  </sql>
  <sql id="FindByUserName_Table_List">
    sys_menu m, sys_user u, sys_user_role ur, sys_role_menu rm
  </sql>

  <!-- 带过滤条件查询(支持分页+不分页) -->
  <select id="select" parameterType="java.util.HashMap" resultMap="BaseResultMap">
    select
    <include refid="Base_Column_List"/>
    from
    <include refid="Base_Table_List"/>
    <where>
      <if test="qc != null">
        <foreach item="item" collection="qc" separator=" and ">
          ${item.ds} ${item.op} #{item.value}
        </foreach>
      </if>
    </where>
  </select>
  <select id="findByUserName" parameterType="java.lang.String" resultMap="BaseResultMap">
    select
    <include refid="FindByUserName_Column_List"/>
    from
    <include refid="FindByUserName_Table_List"/>
    where u.name = #{userName,jdbcType=BIGINT}
    and u.id = ur.user_id
    and ur.role_id = rm.role_id
    and rm.menu_id = m.id
  </select>
</mapper>
