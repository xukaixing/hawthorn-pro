# =====================================
# @Desc: springboot工程配置文件，使用yml方式
# @Auther: andy.ten@tom.com
# @Version: v1.0.9
# =====================================
server:
  tomcat:
    max-connections: 10000
    accept-count: 1000
    threads:
      max: 800
      min-spare: 100

spring:
  #  boot:
  #  admin: # 监控配置 使用注册中心，不需要单独增加client监控
  #  client:
  #    url: http://localhost:8000
  #  instance:
  #    prefer-ip: true
  #  discovery:
  #    ignored-services: consul

  # =====================================
  # consul配置
  # =====================================
  cloud:
    consul:
      enabled: true
      host: localhost
      port: 8500
      discovery:
        enabled: true
        register: true # 是否将自身服务注册到consul中
        hostname: ${server.address}
        health-check-path: /actuator/health  #服务健康检查地址
        health-check-interval: 15s
        health-check-critical-timeout: 30s
        service-name: ${spring.application.name} # 注册到consul的服务名称
        # 默认的id为：${spring.application.name}-${server.port}
        # 默认id配置的问题是：某个微服务即使有多个实例，只要端口相同，那么Consul上依然只会保留1条数据！要想解决这个问题，只需要让不同实例，拥有不同的InstanceId即可。
        instance-id: ${spring.application.name}-${spring.cloud.client.ip-address}-${server.port}

  # =====================================
  # 数据源配置
  # =====================================
  datasource:
    druid:
      url: jdbc:mysql://localhost:3306/hawthorn?serverTimezone=Asia/Shanghai&useUnicode=true&characterEncoding=utf-8&useOldAliasMetadataBehavior=true&useSSL=false&autoReconnect=true&failOverReadOnly=false
      username: root
      password: 123456

  # =====================================
  # redis
  # =====================================
  redis:
    host: 127.0.0.1
    port: 6379 # Redis服务器连接端口
    password: 123456 # Redis服务器连接密码（默认为空）

    #    cluster: # redis集群
    #      max-redirects: 3 # 获取失败 最大重定向次数，默认值是5 一般当此值设置过大时，容易报：Too many Cluster redirections
    #      nodes: # redis节点
    #        - 10.0.0.1:6380
    #        - 10.0.0.2:6380
    #        - 10.0.0.3:6380
    #        - 10.0.0.1:6381
    #        - 10.0.0.2:6381
    #        - 10.0.0.3:6381

    lettuce: # lettuce:springboot2.0+使用；低版本使用：jedis
      pool:
        max-active: 300 # 连接池最大连接数（使用负值表示没有限制）
        max-wait: -1s # 连接池最大阻塞等待时间（使用负值表示没有限制）
        max-idle: 100 # 连接池中的最大空闲连接
        min-idle: 20 # 连接池中的最小空闲连接
    timeout: 30000 # 连接超时时间（毫秒）如果不设置，取默认值2000
    database: 0 # 连接的数据库

  # =====================================
  # zipkin
  # =====================================
  zipkin:
    base-url: http://10.211.55.14:9411/
    compression:
      enabled: true
  sleuth:
    sampler:
      probability: 0.1 #样本采集量，默认为0.1，为了测试这里修改为1，正式环境一般使用默认值（百分比采样）。
    async: #过滤async跟踪
      enabled: false
    web:
      enabled: true
    scheduled: #过滤scheduled跟踪
      enabled: false

  # =====================================
  # rabbitmq
  # =====================================
  rabbitmq:
    host: 10.211.55.14
    port: 5672
    username: hawthorn-rbmq
    password: 123456
    # 虚拟host 可以不设置,使用server默认host，默认的虚拟主机'/'
    # 注意不要带/hawthorn_vhost，因为mq配置的Can access virtual hosts，不是带/的
    virtual-host: hawthorn_vhost
    connection-timeout: 3000 # 默认为-1，单位毫秒，是否允许在重连过程中设置超时时间来中断正在阻塞的发送操作。-1表示不允许，其他表示超时时间。
    #publisher-confirms: true # 开启发送确认,确认消息已发送到交换机(Exchange),老版本使用这个
    publisher-confirm-type: correlated # 确认消息已发送到交换机(Exchange)
    publisher-returns: true # 开启发送失败退回,确认消息已发送到队列(Queue),确认消息已发送到队列，默认为false
    template: # 发送方配置
      retry:
        enabled: true # 开启失败重试，默认为false
        max-attempts: 3 # 尝试发布消息的最大数量，默认为3；
        initial-interval: 10000ms # 第一次重试的间隔时长
        max-interval: 300000ms # 最长重试间隔，超过这个间隔将不再重试
        multiplier: 2 # 下次重试间隔的倍数，此处是2即下次重试间隔是上次的2倍
    # 消费方配置
    listener: # 异步监听配置
      type: SIMPLE # 容器类型simple或direct
      simple:
        auto-startup: true # 启动时自动启动容器,默认为true
        acknowledge-mode: manual # 消息确认方式，其有三种配置方式，分别是none、manual和auto；默认auto
        max-concurrency: 10 # 消费者最大数量
        concurrency: 1 # 消费者最小数量
        retry: # 一般消费者自动签收模式下可以添加下面配置，用于消费抛出异常后进行消息重新投递设置
          enabled: true # 是否开启消费者重试（为false时关闭消费者重试）
          max-attempts: 3 # 最大重试重新投递消息次数
          initial-interval: 5000ms # 重试重新投递消息间隔时间（单位毫秒）
        default-requeue-rejected: false # 重试次数超过上面的设置之后是否丢弃(消费者listener抛出异常，是否重回队列，默认true：重回队列， false为不重回队列(结合死信交换机))

# =====================================
# swagger
# =====================================
springfox:
  documentation:
    swagger-ui:
      enabled: true
knife4j:
  enable: true

# =====================================
# log配置
# =====================================
logging:
  config: classpath:logback-spring-dev.xml
  level:
    #    io.swagger.models.parameters.AbstractSerializableParameter: error
    com.hawthorn: debug
    org.ibatis: debug
    druid.sql: debug
    org.springframework.jdbc: info
    root: info
