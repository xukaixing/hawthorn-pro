# =====================================
# @Desc: springboot工程配置文件，使用yml方式
# @Auther: andy.ten@tom.com
# @Version: v1.1.0
# =====================================

# =====================================
# 启动端口号
# =====================================
server:
  port: 4705
spring:
  application:
    name: hawthorn-redis
  cloud:
    # =====================================
    # consul配置
    # =====================================
    consul:
      enabled: true
      host: 10.211.55.2
      port: 8500
      discovery:
        enabled: true
        register: true
        health-check-path: /actuator/health
        health-check-interval: 15s
        health-check-critical-timeout: 30s
        service-name: ${spring.application.name}
        instance-id: ${spring.application.name}-${spring.cloud.client.ip-address}-${server.port}

    # =====================================
    # config 配置中心
    # =====================================
    config:
      discovery:
        enabled: true  # 开启服务发现
        service-id: hawthorn-configbus # consul配置中心名称
      label: dev-andyten  # 对应git的分支，如果配置中心使用的是本地存储，则该参数无用
      name: application  # 对应{application}部分
      profile: redis-dev  # 对应{profile}部分
      #默认false，是否启动快速失败功能，必须配置该内容，否则无法获取；功能开启则优先判断config server是否正常，在获取不到远程配置时，立即失败，但是用下边的[retry]配置进行重试(粗粒度)
      fail-fast: true
      retry:
        initial-interval: 1000 #最初重试间隔为 1000 毫秒
        max-attempts: 10       #最多重试 10 次
        max-interval: 5000     #最长重试间隔为 5000 毫秒
        multiplier: 1.2        #每次重试失败后，重试间隔所增加的倍数

  # =====================================
  # 数据源配置
  # =====================================
  datasource:
    type: com.alibaba.druid.pool.DruidDataSource
    druid:
      driver-class-name: com.mysql.cj.jdbc.Driver
      initial-size: 10
      min-idle: 10
      max-active: 20
      max-wait: 60000
      time-between-eviction-runs-millis: 60000
      min-evictable-idle-time-millis: 300000
      validation-query: select 'x'
      validation-query-timeout: 5
      test-while-idle: true
      test-on-borrow: false
      test-on-return: false
      pool-prepared-statements: true
      max-pool-prepared-statement-per-connection-size: 20
      use-global-data-source-stat: true
      filters: stat,wall,slf4j
      filter:
        stat:
          enabled: true
          log-slow-sql: true
          slow-sql-millis: 3000
          merge-sql: true
        wall:
          enabled: true
          config:
            alter-table-allow: false
            truncate-allow: false
            drop-table-allow: false
            none-base-statement-allow: false
            update-where-none-check: true
            select-into-outfile-allow: false
            metadata-allow: true
            multiStatementAllow: true
            condition-and-alway-true-allow: true
            comment-allow: true
          log-violation: true
          throw-exception: true
        slf4j:
          enabled: true
          connection-log-enabled: false
          connection-close-after-log-enabled: false
          connection-commit-after-log-enabled: false
          connection-rollback-after-log-enabled: false
          connection-connect-after-log-enabled: false
          connection-connect-before-log-enabled: false
          connection-log-error-enabled: false
          data-source-log-enabled: false
          result-set-log-enabled: false
          statement-log-enabled: false
          statement-create-after-log-enabled: false
          statement-executable-sql-log-enable: true
          statement-log-error-enabled: false
      stat-view-servlet:
        enabled: true
        login-username: ${DRUID_USER:admin}
        login-password: ${DRUID_PWD:admin123}
        url-pattern: "/druid/*"
        reset-enable: false
      web-stat-filter:
        enabled: true
        url-pattern: /*
        exclusions: "*.js,*.gif,*.jpg,*.png,*.css,*.ico,/druid/*"
        profile-enable: true
        session-stat-max-count: 100000
        session-stat-enable: false
      aop-patterns: com.hawthorn.*.service.*

# =====================================
# mybatis plus 配置
# =====================================
mybatis-plus:
  mapper-locations: classpath*:/mapper/*Mapper.xml
  global-config:
    db-config:
      id-type: AUTO
      select-strategy: ignored
      insert-strategy: ignored
      update-strategy: ignored
      table-underline: true
      logic-delete-value: 0
      logic-not-delete-value: -1
  configuration:
    map-underscore-to-camel-case: true
    cache-enabled: false
